{
	"info": {
		"_postman_id": "saque-pix-api-collection",
		"name": "Saque PIX API - Testes Completos",
		"description": "Collection completa para testar todos os requisitos do case Saque PIX",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Health Check & M√©tricas",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": ["{{base_url}}"],
							"path": ["health"]
						},
						"description": "Verifica se o servidor est√° rodando e se banco/redis est√£o OK"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 or 503\", function () {",
									"    pm.expect([200, 503]).to.include(pm.response.code);",
									"});",
									"",
									"pm.test(\"Response has status field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('status');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "M√©tricas (Prometheus)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/metrics",
							"host": ["{{base_url}}"],
							"path": ["metrics"]
						},
						"description": "Retorna m√©tricas no formato Prometheus\n\n**√ötil para:**\n- Integra√ß√£o com Prometheus\n- Monitoramento de performance\n- An√°lise de m√©tricas do sistema"
					},
					"response": []
				},
				{
					"name": "M√©tricas (JSON)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/metrics/json",
							"host": ["{{base_url}}"],
							"path": ["metrics", "json"]
						},
						"description": "Retorna m√©tricas no formato JSON com estat√≠sticas enriquecidas\n\n**Inclui:**\n- M√©tricas de performance\n- Estat√≠sticas de histogramas\n- Labels e valores\n- Timestamp"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has metrics\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('metrics');",
									"    pm.expect(jsonData).to.have.property('timestamp');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				}
			]
		},
		{
			"name": "2. Contas",
			"item": [
				{
					"name": "Listar Contas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/accounts",
							"host": ["{{base_url}}"],
							"path": ["accounts"]
						},
						"description": "Lista todas as contas cadastradas"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Response has data array\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.be.an('array');",
									"});",
									"",
									"// Salvar primeiro account_id se existir",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.length > 0) {",
									"    pm.collectionVariables.set('account_id', jsonData.data[0].id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Criar Conta",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Jo√£o Silva\",\n  \"balance\": 1000.00\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/accounts",
							"host": ["{{base_url}}"],
							"path": ["accounts"]
						},
						"description": "Cria uma nova conta\n\n**Campos:**\n- `name` (obrigat√≥rio): Nome da conta\n- `balance` (opcional): Saldo inicial (padr√£o: 0.00)"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Response has account data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name');",
									"    pm.expect(jsonData.data).to.have.property('balance');",
									"});",
									"",
									"// Salvar account_id automaticamente",
									"var jsonData = pm.response.json();",
									"if (jsonData.success && jsonData.data && jsonData.data.id) {",
									"    pm.collectionVariables.set('account_id', jsonData.data.id);",
									"    console.log('Account ID salvo: ' + jsonData.data.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Buscar Conta por ID",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/accounts/{{account_id}}",
							"host": ["{{base_url}}"],
							"path": ["accounts", "{{account_id}}"]
						},
						"description": "Busca uma conta espec√≠fica pelo ID (UUID)"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Response has account data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('id');",
									"    pm.expect(jsonData.data).to.have.property('name');",
									"    pm.expect(jsonData.data).to.have.property('balance');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				}
			]
		},
		{
			"name": "3. Saque Imediato",
			"item": [
				{
					"name": "Saque Imediato - Sucesso",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"joao@email.com\"\n  },\n  \"amount\": 150.75,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Realiza um saque imediato (processa na hora)\n\n**Valida√ß√µes esperadas:**\n- HTTP 201 Created\n- Campo `done: true`\n- Saldo deduzido\n- Email enviado (verificar em http://localhost:8025)"
					},
					"response": []
				},
				{
					"name": "Saque Imediato - Valor Pequeno",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Teste com valor menor para verificar processamento"
					},
					"response": []
				}
			]
		},
		{
			"name": "4. Saque Agendado",
			"item": [
				{
					"name": "üìã Listar Saques da Conta",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/withdraws",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "withdraws"]
						},
						"description": "Lista todos os saques de uma conta espec√≠fica\n\n**√ötil para:**\n- Ver hist√≥rico de saques\n- Encontrar ID de saque agendado para cancelar\n- Verificar status de saques\n\n**Resposta inclui:**\n- ID do saque\n- Valor\n- Status (done, error, scheduled)\n- Data de agendamento (se aplic√°vel)\n- Dados do PIX"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"// Auto-save: encontrar primeiro saque agendado pendente e salvar ID",
									"if (pm.response.code === 200) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.length > 0) {",
									"        // Procurar primeiro saque agendado que n√£o foi processado",
									"        var scheduledWithdraw = jsonData.data.find(function(w) {",
									"            return w.scheduled === true && w.done === false && w.error === false;",
									"        });",
									"        ",
									"        if (scheduledWithdraw && scheduledWithdraw.id) {",
									"            pm.collectionVariables.set('withdraw_id', scheduledWithdraw.id);",
									"            console.log('‚úÖ Saque agendado encontrado! ID salvo: ' + scheduledWithdraw.id);",
									"        } else {",
									"            console.log('‚ÑπÔ∏è Nenhum saque agendado pendente encontrado');",
									"        }",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Saque Agendado - 1 Hora",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"joao@email.com\"\n  },\n  \"amount\": 100.00,\n  \"schedule\": \"2026-12-25 15:00\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Cria um saque agendado para data futura\n\n**Valida√ß√µes esperadas:**\n- HTTP 201 Created\n- Campo `scheduled: true`\n- Campo `done: false` (ainda n√£o processado)\n- Campo `scheduled_for` com a data/hora\n- Saldo N√ÉO deduzido ainda\n\n**Para processar manualmente:**\ndocker-compose exec app php bin/hyperf.php withdraw:process-scheduled"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Withdraw is scheduled\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.scheduled).to.eql(true);",
									"});",
									"",
									"pm.test(\"Withdraw is not done yet\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.done).to.eql(false);",
									"});",
									"",
									"pm.test(\"Has scheduled_for date\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.scheduled_for).to.not.be.null;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Saque Agendado - Amanh√£",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 200.00,\n  \"schedule\": \"2026-01-01 10:00\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Saque agendado para amanh√£\n\n**Ap√≥s criar, copie o `id` do saque para usar no cancelamento**"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"// Salvar withdraw_id para usar no cancelamento",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.id) {",
									"        pm.collectionVariables.set('withdraw_id', jsonData.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "‚úÖ Cancelar Saque Agendado",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/withdraw/{{withdraw_id}}",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "withdraw", "{{withdraw_id}}"]
						},
						"description": "Cancela um saque agendado antes de ser processado\n\n**Valida√ß√µes esperadas:**\n- HTTP 200 OK\n- Campo `cancelled: true`\n- Campo `error: true`\n- Campo `error_reason: \"Cancelled by user\"`\n- Email de cancelamento enviado (verificar em http://localhost:8025)\n\n**Como usar:**\n1. Execute \"üìã Listar Saques da Conta\" primeiro - ele automaticamente salva o ID de um saque agendado\n2. Ou crie um saque agendado - o ID ser√° salvo automaticamente\n3. Execute este request para cancelar\n\n**Nota:** O `withdraw_id` √© salvo automaticamente ao listar saques ou criar saque agendado"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Withdraw is cancelled\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.cancelled).to.eql(true);",
									"    pm.expect(jsonData.data.error).to.eql(true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "‚ùå Tentar Cancelar Saque J√° Processado",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/withdraw/{{withdraw_id}}",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "withdraw", "{{withdraw_id}}"]
						},
						"description": "Tenta cancelar um saque que j√° foi processado\n\n**Resultado esperado:**\n- HTTP 400 Bad Request\n- Mensagem: \"Cannot cancel already processed withdraw\""
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Response has error message\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('error');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				}
			]
		},
		{
			"name": "5. Valida√ß√µes de Neg√≥cio",
			"item": [
				{
					"name": "‚ùå Saldo Insuficiente",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 10000.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta sacar mais que o saldo dispon√≠vel\n\n**Resultado esperado:**\n- HTTP 400 Bad Request\n- Mensagem: \"Insufficient balance\""
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Response has error message\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('error');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "‚ùå Agendar para Passado",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": \"2020-01-01 15:00\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta agendar saque para data no passado\n\n**Resultado esperado:**\n- HTTP 422 Unprocessable Entity\n- Erro de valida√ß√£o: \"schedule\" deve ser no futuro"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 422\", function () {",
									"    pm.response.to.have.status(422);",
									"});",
									"",
									"pm.test(\"Response has validation error\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('error');",
									"    pm.expect(jsonData.error).to.include('Validation failed');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "‚ùå M√©todo Inv√°lido",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"TED\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta usar m√©todo diferente de PIX\n\n**Resultado esperado:**\n- HTTP 422 Unprocessable Entity\n- Erro: m√©todo deve ser \"PIX\""
					},
					"response": []
				},
				{
					"name": "‚ùå Tipo PIX Inv√°lido",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"cpf\",\n    \"key\": \"12345678900\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta usar tipo PIX diferente de email\n\n**Resultado esperado:**\n- HTTP 422 Unprocessable Entity\n- Erro: tipo deve ser \"email\""
					},
					"response": []
				},
				{
					"name": "‚ùå Email Inv√°lido",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"email-invalido\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta usar email inv√°lido\n\n**Resultado esperado:**\n- HTTP 422 Unprocessable Entity\n- Erro de valida√ß√£o de email"
					},
					"response": []
				},
				{
					"name": "‚ùå Valor Negativo",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer test-token"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": -10.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta sacar valor negativo\n\n**Resultado esperado:**\n- HTTP 422 Unprocessable Entity\n- Erro: amount deve ser maior que 0.01"
					},
					"response": []
				},
				{
					"name": "‚ùå Sem Autentica√ß√£o",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"method\": \"PIX\",\n  \"pix\": {\n    \"type\": \"email\",\n    \"key\": \"teste@email.com\"\n  },\n  \"amount\": 50.00,\n  \"schedule\": null\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/account/{{account_id}}/balance/withdraw",
							"host": ["{{base_url}}"],
							"path": ["account", "{{account_id}}", "balance", "withdraw"]
						},
						"description": "Tenta fazer saque sem token de autentica√ß√£o\n\n**Resultado esperado:**\n- HTTP 401 Unauthorized\n- Mensagem: \"Missing or invalid authorization token\""
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 401\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"pm.test(\"Response has unauthorized error\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('error');",
									"    pm.expect(jsonData.error).to.include('Unauthorized');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				}
			]
		},
		{
			"name": "6. Admin & Observabilidade",
			"item": [
				{
					"name": "Admin Dashboard (HTML)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin",
							"host": ["{{base_url}}"],
							"path": ["admin"]
						},
						"description": "Interface HTML administrativa\n\n**Acesse no navegador:** http://localhost:9501/admin\n\n**Funcionalidades:**\n- Visualizar contas\n- Criar contas\n- Ver saques\n- Processar saques agendados\n- Ver m√©tricas e estat√≠sticas"
					},
					"response": []
				},
				{
					"name": "Admin - Listar Contas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/accounts",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "accounts"]
						},
						"description": "Lista todas as contas (API admin)\n\n**Diferen√ßa da rota /accounts:**\n- Retorna at√© 50 contas mais recentes\n- Ordenado por data de cria√ß√£o (mais recentes primeiro)"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Criar Conta",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Conta Admin\",\n  \"balance\": 2000.00\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/admin/api/accounts",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "accounts"]
						},
						"description": "Cria uma nova conta via API admin\n\n**Campos:**\n- `name` (obrigat√≥rio): Nome da conta\n- `balance` (opcional): Saldo inicial"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"// Salvar account_id se criado",
									"if (pm.response.code === 201) {",
									"    var jsonData = pm.response.json();",
									"    if (jsonData.data && jsonData.data.id) {",
									"        pm.collectionVariables.set('account_id', jsonData.data.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Listar Saques",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/withdraws",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "withdraws"]
						},
						"description": "Lista todos os saques (API admin)\n\n**Retorna:**\n- Todos os saques do sistema\n- Ordenados por data de cria√ß√£o\n- Inclui status, valores, datas"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Saques Agendados Pendentes",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/withdraws/pending",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "withdraws", "pending"]
						},
						"description": "Lista apenas saques agendados pendentes\n\n**√ötil para:**\n- Ver quantos saques est√£o aguardando processamento\n- Verificar se o cron est√° funcionando\n- Debug de saques agendados"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has pending_count\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('pending_count');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Processar Saques Agendados",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/process-scheduled",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "process-scheduled"]
						},
						"description": "Processa saques agendados manualmente\n\n**Equivalente ao comando CLI:**\n`docker-compose exec app php bin/hyperf.php withdraw:process-scheduled`\n\n**Retorna:**\n- Quantidade de saques processados\n- Mensagem de sucesso"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has processed count\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData).to.have.property('processed');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Atualizar Saques para Passado (Teste)",
					"request": {
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/update-scheduled-for-past",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "update-scheduled-for-past"]
						},
						"description": "‚ö†Ô∏è **APENAS PARA TESTES**\n\nAtualiza saques agendados pendentes para 1 hora no passado.\n\n**√ötil para:**\n- Testar processamento de saques agendados sem esperar\n- For√ßar processamento imediato de saques agendados\n\n**‚ö†Ô∏è CUIDADO:** Isso modifica dados no banco. Use apenas em ambiente de desenvolvimento/testes."
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"console.log('‚ö†Ô∏è Saques atualizados para o passado. Execute process-scheduled para process√°-los.');"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - M√©tricas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/metrics",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "metrics"]
						},
						"description": "Retorna m√©tricas do sistema (API admin)\n\n**Inclui:**\n- M√©tricas de performance\n- Contadores de requisi√ß√µes\n- Tempos de resposta\n- Estat√≠sticas de saques"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has metrics data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				},
				{
					"name": "Admin - Estat√≠sticas",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/api/stats",
							"host": ["{{base_url}}"],
							"path": ["admin", "api", "stats"]
						},
						"description": "Retorna estat√≠sticas gerais do sistema\n\n**Inclui:**\n- Total de contas\n- Total de saques\n- Saques processados\n- Saques pendentes\n- Saques com erro\n- Valores totais"
					},
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response has stats data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData).to.have.property('data');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"response": []
				}
			]
		},
		{
			"name": "7. Verifica√ß√µes",
			"item": [
				{
					"name": "Listar Saques (CLI)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": ["{{base_url}}"],
							"path": [""]
						},
						"description": "Comando CLI:\ndocker-compose exec app php bin/hyperf.php withdraw:list\n\nLista todos os saques criados com seus status."
					},
					"response": []
				},
				{
					"name": "Processar Saques Agendados (CLI)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": ["{{base_url}}"],
							"path": [""]
						},
						"description": "Comando CLI para processar saques agendados manualmente:\ndocker-compose exec app php bin/hyperf.php withdraw:process-scheduled\n\n**Nota:** O cron processa automaticamente a cada minuto, mas voc√™ pode processar manualmente para testes."
					},
					"response": []
				},
				{
					"name": "Verificar Emails - Mailhog",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8025",
							"protocol": "http",
							"host": ["localhost"],
							"port": "8025",
							"path": [""]
						},
						"description": "Acesse http://localhost:8025 no navegador para ver os emails enviados ap√≥s cada saque processado.\n\n**Conte√∫do esperado no email:**\n- Data e hora do saque\n- Valor sacado\n- Dados do PIX (tipo e chave)"
					},
					"response": []
				},
				{
					"name": "Estat√≠sticas (CLI)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/",
							"host": ["{{base_url}}"],
							"path": [""]
						},
						"description": "Comando CLI:\ndocker-compose exec app php bin/hyperf.php stats\n\nMostra estat√≠sticas dos saques (total, processados, pendentes, erros)."
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:9501",
			"type": "string"
		},
		{
			"key": "account_id",
			"value": "",
			"type": "string",
			"description": "ID da conta (UUID). Obtenha criando uma conta via CLI:\ndocker-compose exec app php bin/hyperf.php account:create \"Nome\" --balance=1000.00"
		},
		{
			"key": "auth_token",
			"value": "test-token",
			"type": "string",
			"description": "Token de autentica√ß√£o para desenvolvimento local"
		},
		{
			"key": "withdraw_id",
			"value": "",
			"type": "string",
			"description": "ID do saque (UUID). Obtenha criando um saque agendado e copiando o `id` da resposta"
		}
	]
}

